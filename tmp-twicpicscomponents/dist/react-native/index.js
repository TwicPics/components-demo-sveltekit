"use strict";var e=require("react"),t=require("react-native");const r=e=>`twicpics-components ${e}`,i=()=>{},n=(e,t)=>r=>{let i;return r&&`${r}`.replace(e,((e,t)=>i=t)),t?t(i):i},a=e=>{throw new Error(r(e))},o=(e,t="\\s")=>new RegExp(`^(?:${t})*(${Array.isArray(e)?e.join("|"):e})(?:${t})*$`),s=["center"];for(const e of["","bottom","top"])for(const t of["","left","right"])(t||e)&&s.push(e?t?`${e}-${t}`:e:t);o(s),o("\\s*(\\d+)\\s*[x]\\s*(\\d+)\\s*");const c=o(["contain","cover"]),l=o(["maincolor","meancolor","none","preview"]),d=o("(\\d+(?:\\.\\d+)?)(?:\\s*[\\/:]\\s*(\\d+(?:\\.\\d+)?))?|(none)"),u=o(["debug","offline","production"]),h={debug:!1,class:"twic",domain:void 0,env:"production",handleShadowDom:i,maxDPR:void 0,path:"",step:void 0},m=/\?|^\/*$/,p=/(^https?:\/\/[^/]+)\/*$/,f=/^(image:)?\/*/,g=e=>!isNaN(e)&&e>0,w=n(o(".+?")),$=o(".+?","[\\s\\/]"),v=/\b(?:(left|right)|(bottom|top))\b/g,b=w,y=w,x=n(c),S=n($,(e=>e&&`${e}/`)),R={true:"fade",false:"none",fade:"fade",zoom:"zoom",none:"none"},O=w,P=w,z=/^(?:(auth|placeholder|rel)|(image|media|video)|[^:]*):(\/*)((v[0-9]+(?=[/?]))?[^?]*(\?.*)?)$/,D=({x:e,y:t},r,i,n,a=!1)=>{const o="contain"!==i&&(r||(t?e?`${t}-${e}`:t:e));return`${a?"debug/":""}${n||""}${o?`focus=${o}/`:""}`},E=/\/?([^/?#.]+)(?:\.[^/?#]*)?(?:[?#].*)?$/;var N=e=>{(e=>{e||a("install options not provided"),h&&h.domain;const{domain:t,class:r,env:n,handleShadowDom:o,path:s}=e;t&&p.test(t)||a(`install domain "${t}" is invalid`),s&&m.test(s)&&a(`install path "${s}" is invalid`),n&&!u.test(n)&&a(`install env "${n}" is invalid`),h.class=r||"twic",h.domain=t.replace(p,"$1"),h.env=n,h.path=s?s.replace(/^\/*(.+?)\/*$/,"$1/"):"",h.handleShadowDom=i;{const{debug:t,maxDPR:r,step:i}=e;h.debug=t,h.maxDPR=r,h.step=i}})(Object.assign({maxDPR:2,step:10},e))};const A={center:"contain-max",cover:"cover",contain:"contain",stretch:"resize",repeat:"contain-max"},M=({anchor:e,focus:r,lqip:i=!1,mode:n,placeholder:a,preTransform:o,src:s,step:c,viewSize:l})=>{if(i&&/^placeholder:.*$/.test(s))return;const{debug:d,domain:u,path:m}=h,{width:p,height:f}=((e,r,i)=>{const n=Math.min(Math.max(1,t.PixelRatio.get()),h.maxDPR);let a=(t=>{const r=e||h.step;return Math.max(r,r*Math.floor(t/r))})(i.width*n),o=i.ratio?a*i.ratio:i.height*n;if(h.debug&&console.debug("size and pixelRatio",i,n,{_actualWidth:a,_actualHeight:o}),r){const e=a/o;a=o=1e3,e>1?o=Math.floor(o/e):a=Math.floor(a*e)}return{width:Math.round(a),height:Math.round(o)}})(c,i,l);return(({debug:e,domain:t,path:r,output:i,quality:n,src:a,transform:o})=>{const s=`${t}/`,c=a.slice(0,s.length)===s,l=c?`media:${a.slice(s.length)}`:a,d=z.exec(l),u=d&&d[2],h=e?"/debug":"",m=i?`/output=${i}`:"",p=u?r&&!c?`${r}${d[3]?d[3][0]:""}${d[4]}`:d[4]:l,f=n?`/quality=${n}`:"",g=o?`/${o}`:"";return`${s}${d&&(d[1]||d[5])?`v1${h}${g}${m}/${u?`${d[2]}:${p}`:p}${f}`:`${p}${d&&d[6]?"&":"?"}twic=v1${h}${g}${m}${f}`}`})({debug:d&&"web"===t.Platform.OS,domain:u,path:m,src:s,transform:`${D(e,r,n,o,!1)}${A[n]}=${p}x${f}`,output:i?a:""})},j=(e,t)=>{if(t){let r=e||{};return Array.isArray(e)&&(r=e.reduce(((e,t)=>Object.assign(Object.assign({},e),t)),{})),r=JSON.parse(JSON.stringify(r)),r.height=void 0,r.aspectRatio=1/t,r}return e},T={left:"flex-start",right:"flex-end",top:"flex-start",bottom:"flex-end"},q=(e,t)=>{if("contain"===t){const{x:t,y:r}=e;return{alignItems:T[t]||"center",justifyContent:T[r]||"center"}}return{}},I=(e,r,i,n)=>({delay:Number(r||0),duration:Number(i||200),easing:n||t.Easing.ease,toValue:e,useNativeDriver:!0}),V=(e,t)=>{if(e){const{ratioIntrinsic:r}=e,i=t.width/t.height;return Math.max(1,Math.round(r>i?t.width:t.height*r))}return 0},L=(e,t,r)=>({height:r?e*r:t,ratio:r||(e?t/e:void 0),width:e}),k=/(?:(?:width="([0-9]*)").*(?:height="([0-9]*)").*)(?:(?:background:(#[0-9a-fA-F]*)")|(?:href="([^"]*)))/,C=e.memo((i=>{const{viewSize:n}=i,a=b(i.alt),o=(e=>{const t=w(e);let r,i;if(t){let e;for(;e=v.exec(t);)e[1]?r=e[1]:i=e[2]}return{x:r,y:i}})(i.anchor),s=y(i.focus),c=x(i.mode)||"cover",d=((e,t)=>{if("offline"!==h.env&&w(t)&&"none"!==e)return l.test(e)?e:"preview"})(i.placeholder,i.src),u=S(i.preTransform),m=(L=i.src,(L=w(L))||console.warn(r("src is not provided")),(e=>e?e.replace(f,`image:${h.path}`):"placeholder:red")(L)),p=(e=>{if("number"!=typeof e){const t=w(e);e=t&&Number(t)}return g(e)?e:void 0})(i.step),$=(e=>{"boolean"!=typeof e&&(e=w(e)||!0);const t={};return String(e).split(/\s*\+\s*|\s+/).forEach((e=>t[`${R[e]||"fade"}`]=!0)),t})(i.transition),z=O(i.transitionDelay),D=P(i.transitionDuration),N=i.transitionTimingFunction||t.Easing.ease,A=((e,t)=>{if(!e){const r=E.exec(t);e=r&&r[1]||"image"}return e})(a,m),{media:j,lqip:T}={media:M(C={anchor:o,focus:s,mode:c,placeholder:d,preTransform:u,src:m,step:p,viewSize:n}),lqip:M(Object.assign(Object.assign({},C),{lqip:!0}))};var L,C;const F=e.useRef(((e,t)=>{let r;const i=Object.assign({leading:!0,ms:0,trailing:!0},{leading:!1,ms:100});return(...t)=>{!r&&i.leading&&e(...t),clearTimeout(r),r=setTimeout((()=>{r=void 0,i.trailing&&e(...t)}),i.ms)}})((async(e,r,i)=>{const n=await(async(e,r,i)=>{const n=t=>{const{height:r,width:n,placeholder:a}=t;return{placeholder:a,ratioIntrinsic:r?n/r:1/i.ratio,src:e}};return r?n(await(async e=>{const r=await fetch(e),i=await r.text(),n=k.exec(i);return{placeholder:{blurRadius:"web"===t.Platform.OS?0:5,color:n&&n[3],uri:"web"===t.Platform.OS?e:n&&n[4]},height:n&&Number(n[2])||void 0,width:n&&Number(n[1])||void 0}})(r)):new Promise((r=>{t.Image.getSize(e,((e,t)=>{r(n({width:e,height:t}))}))}))})(e,r,i);W(n)}))).current,_=e.useRef(new t.Animated.Value(0)),B=e.useRef(new t.Animated.Value($.hasOwnProperty("zoom")?0:1)),[H,W]=e.useState(void 0);return e.useEffect((()=>{_.current.setValue($.hasOwnProperty("fade")?1:0),F(j,T,n)}),[j,T]),e.createElement(t.Animated.View,{style:[J.layout,q(o,c),{transform:[{scale:B.current}]}]},e.createElement(t.ImageBackground,{accessibilityLabel:A,onLoad:()=>{$.hasOwnProperty("none")?_.current.setValue(0):(t.Animated.timing(_.current,I(0,z,D,N)).start(),t.Animated.timing(B.current,I(1,z,D,N)).start())},source:{uri:null==H?void 0:H.src},style:{aspectRatio:null==H?void 0:H.ratioIntrinsic,width:V(H,n)}},(null==H?void 0:H.placeholder)&&e.createElement(t.Animated.Image,{accessibilityLabel:`${A}-placeholder`,blurRadius:H.placeholder.blurRadius||0,source:{uri:H.placeholder.uri},style:[J.placeholder,{backgroundColor:H.placeholder.color,opacity:_.current}]})))}));class F extends e.Component{constructor(e){super(e),this.state={viewSize:void 0,ready:!1}}render(){const{props:r}=this,i=(e=>{if("none"===e)return 0;let t;if("number"==typeof e)t=e;else if(e){const r=d.exec(e);if(r){const[,,e,i]=r;t=(i?Number(i):1)/Number(e)}else t=1}return g(t)?t:void 0})(r.ratio||1);return e.createElement(t.View,{style:t.StyleSheet.flatten([J.container,j(r.style,i)]),onLayout:e=>{const{width:t,height:r}=e.nativeEvent.layout;this.setState({viewSize:L(t,r,i),ready:t>0&&r>0})}},this.state.ready?e.createElement(C,Object.assign({},r,{viewSize:this.state.viewSize})):void 0)}}const J=t.StyleSheet.create({container:{overflow:"hidden",width:"100%"},layout:{flex:1,flexDirection:"column",overflow:"hidden"},placeholder:{height:"100%",width:"100%"},wrapper:{overflow:"hidden",width:"100%",height:"100%"}}),_=N;exports.TwicImg=F,exports.installTwicPics=N,exports.installTwicpics=_;
//# sourceMappingURL=index.js.map
