var n=function(a){if(!a){return undefined}var e=a.attributes,r=a["element"],t=a.elementName,o=a.value;var i=r||document.createElement(t||"div");if(e&&i instanceof HTMLElement){for(var c=0,f=Object.entries(e);c<f.length;c++){var v=f[c],u=v[0],s=v[1];i.setAttribute(u,String(s))}}if(o){if(typeof o==="string"){i.innerHTML=o}else{for(var d=0,l=Array.isArray(o)?o:[o];d<l.length;d++){var p=l[d];var m=n(p);if(m){i.appendChild(m)}}}}return i};var a=/px$/;var e=function(n){return Number(n.replace(a,""))};var r=function(){r=Object.assign||function n(a){for(var e,r=1,t=arguments.length;r<t;r++){e=arguments[r];for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o))a[o]=e[o]}return a};return r.apply(this,arguments)};var t=function(n){return"twicpics-components ".concat(n)};var o=function(n,a){var e;var t=r({leading:true,ms:0,trailing:true},a);return function(){var a=[];for(var r=0;r<arguments.length;r++){a[r]=arguments[r]}if(!e&&t.leading){n.apply(void 0,a)}clearTimeout(e);e=setTimeout((function(){e=undefined;if(t.trailing){n.apply(void 0,a)}}),t.ms)}};var i="SVELTEKIT"==="webcomponents";var c=typeof document!=="undefined";var f="SVELTEKIT"==="react-native";var v=function(n){console.warn(t(n))};var u=function(){return undefined};var s=function(n,a){if(a===void 0){a=undefined}return function(e){var r;if(e){"".concat(e).replace(n,(function(n,a){return r=a}))}return a?a(r):r}};var d=function(n){throw new Error(t(n))};var l=function(n,a){if(a===void 0){a="\\s"}return new RegExp("^(?:".concat(a,")*(").concat(Array.isArray(n)?n.join("|"):n,")(?:").concat(a,")*$"))};var p=["center"];for(var m=0,h=["","bottom","top"];m<h.length;m++){var g=h[m];for(var w=0,b=["","left","right"];w<b.length;w++){var y=b[w];if(y||g){p.push(g?y?"".concat(g,"-").concat(y):g:y)}}}l(p);var x=l("\\s*(\\d+)\\s*[x]\\s*(\\d+)\\s*");var S=["contain","cover"];var E=l(S);var T=["maincolor","meancolor","none","preview"];var O=l(T);var N=l("(\\d+(?:\\.\\d+)?)(?:\\s*[\\/:]\\s*(\\d+(?:\\.\\d+)?))?|(none)");var P=["debug","offline","production"];var k=l(P);var D="v1";var M="twic";var z={debug:false,class:M,domain:undefined,env:"production",handleShadowDom:u,maxDPR:undefined,path:"",step:undefined};var $=function(){return".twic-w>.".concat(z["class"],"-done+div,.twic-w>.").concat(z["class"],"-poster-done+div{opacity:0 !important}.twic-w>.").concat(z["class"],"-done,.twic-w>.").concat(z["class"],"-poster-done{transform:none !important}")};var j=function(n){return"data-".concat(z["class"],"-").concat(n)};var A=/\?|^\/*$/;var H=/(^https?:\/\/[^/]+)\/*$/;var R=function(a){var e=new WeakSet;return function(r){while(r&&!e.has(r)){e.add(r);var t=r.parentNode;var o=!t&&r instanceof ShadowRoot;if(o){if(r.mode==="closed"){throw new Error("cannot use TwicPics components in closed ShadowRoot")}n({element:r,value:{elementName:"style",value:"*STYLE*".concat($())}});r=r.host;if(r){r.setAttribute(a,"")}}else{r=t}}}};var L=[["anticipation","anticipation"],["class","class"],["maxDPR","max-dpr"],["step","step"]];var B=function(a){if(!a){d("install options not provided")}var e=z&&z.domain;var r=a.domain,t=a["class"],o=a.env,i=a.handleShadowDom,s=a.path;if(!r||!H.test(r)){d('install domain "'.concat(r,'" is invalid'))}if(s&&A.test(s)){d('install path "'.concat(s,'" is invalid'))}if(o&&!k.test(o)){d('install env "'.concat(o,'" is invalid'))}z["class"]=t||M;z.domain=r.replace(H,"$1");z.env=o;z.path=s?s.replace(/^\/*(.+?)\/*$/,"$1/"):"";z.handleShadowDom=i&&c&&!f?R(j("component")):u;if(c&&!f){if(e){v("install function called multiple times");return}var l=["".concat(z.domain,"/?").concat(D)];L.forEach((function(n){var e=n[0],r=n[1];if(a.hasOwnProperty(e)){var t=a[e];if(t){l.push("".concat(r,"=").concat(a[e]))}}}));n({element:document.head,value:[{attributes:{rel:"preconnect",href:r},elementName:"link"},{attributes:{async:"",defer:"",src:l.join("&")},elementName:"script"},{value:$(),elementName:"style"}]})}};var W=/^(image:)?\/*/;var C=function(n){return!isNaN(n)&&n>0};var F=s(l(".+?"));var I=l(".+?","[\\s\\/]");var q=/\b(?:(left|right)|(bottom|top))\b/g;var K=function(n){var a=F(n);var e;var r;if(a){var t=void 0;while(t=q.exec(a)){if(t[1]){e=t[1]}else{r=t[2]}}}return{x:e,y:r}};var V=F;var Z=function(n){return typeof n==="string"?n.trim():undefined};var J=F;var Y=F;var G=function(n){if(!n){return undefined}var a;var e=x.exec(n);if(e){var r=e[2],t=e[3];a="".concat(r,"x").concat(t)}return a};var Q={true:true,false:false,"":true};var U=function(n){if(typeof n==="boolean"){return n}if(n===undefined){return false}return Q[n.trim()]||false};var X=s(E);var _=function(n,a){if(z.env==="offline"||!F(a)||n==="none"){return undefined}return O.test(n)?n:"preview"};var nn=F;var an=s(I,(function(n){return n&&"".concat(n,"/")}));var en=function(n){if(n==="none"){return 0}var a;if(typeof n==="number"){a=n}else if(n){var e=N.exec(n);if(e){var r=e[2],t=e[3];a=(t?Number(t):1)/Number(r)}else{a=1}}return C(a)?a:undefined};var rn=function(n){if(typeof n!=="number"){var a=F(n);n=a&&Number(a)}return C(n)?n:undefined};var tn=function(n){return n?n.replace(W,"image:".concat(z.path)):"placeholder:red"};var on=function(n){n=F(n);if(!n){v("src is not provided")}return z.env==="offline"?"":tn(n)};var cn={true:"fade",false:"none",fade:"fade",zoom:"zoom",none:"none"};var fn=function(n){if(typeof n!=="boolean"){n=F(n)||true}var a={};String(n).split(/\s*\+\s*|\s+/).forEach((function(n){return a["".concat(cn[n]||"fade")]=true}));return a};var vn=F;var un=F;var sn=F;var dn=/^(?:(auth|placeholder|rel)|(image|media|video)|[^:]*):(\/*)((v[0-9]+(?=[/?]))?[^?]*(\?.*)?)$/;var ln=4;var pn=2;var mn=6;var hn=5;var gn=3;var wn=1;var bn="v1";var yn=function(n){var a=n.debug,e=n.domain,r=n.path,t=n.output,o=n.quality,i=n.src,c=n.transform;var f="".concat(e,"/");var v=i.slice(0,f.length)===f;var u=v?"media:".concat(i.slice(f.length)):i;var s=dn.exec(u);var d=s&&s[pn];var l=a?"/debug":"";var p=t?"/output=".concat(t):"";var m=d?r&&!v?"".concat(r).concat(s[gn]?s[gn][0]:"").concat(s[ln]):s[ln]:u;var h=o?"/quality=".concat(o):"";var g=c?"/".concat(c):"";return"".concat(f).concat(s&&(s[wn]||s[hn])?"".concat(bn).concat(l).concat(g).concat(p,"/").concat(d?"".concat(s[pn],":").concat(m):m).concat(h):"".concat(m).concat(s&&s[mn]?"&":"?","twic=").concat(bn).concat(l).concat(g).concat(p).concat(h))};var xn=function(n,a,e){var r=n.x,t=n.y;return a==="contain"&&(e||(t?r?"".concat(r," ").concat(t):t:r))};var Sn=function(n,a,e,r,t){var o=n.x,i=n.y;if(t===void 0){t=false}var c=e!=="contain"&&(a||(i?o?"".concat(i,"-").concat(o):i:o));return"".concat(t?"debug/":"").concat(r||"").concat(c?"focus=".concat(c,"/"):"")};var En=function(n,a,e){var r={};if(a){r["transitionDuration"]=a}if(n){r["transitionDelay"]=n}if(e){r["transitionTimingFunction"]=e}return r};var Tn=/\/?([^/?#.]+)(?:\.[^/?#]*)?(?:[?#].*)?$/;var On=function(n,a){if(!n){var e=Tn.exec(a);n=e&&e[1]||"image"}return n};var Nn=function(n,a,e,r,t,o,i,c,f,v){var u={};var s=Sn(n,r,i,c,z.env==="debug");if(typeof a==="string"){u[j("bot")]=a||"/"}if(e){u[j("eager")]=""}if(t){u[j("intrinsic")]=t}if(o){u[j("poster")]=f;u[j("poster-transform")]="".concat(s,"*/output=image")}if(f){u[j("src")]=f}if(v!==undefined){u[j("step")]=String(v)}if(s){u[j("transform")]="".concat(s,"*")}return u};var Pn=function(n,a,e,r,t,o,i,c,f,v,u,s,d){var l=En(v,u,s);d({anchor:n,focus:a,mode:e,placeholder:r,preTransform:o,ratio:i,src:c,transitions:f});if(e){l["backgroundSize"]=e}var p=xn(n,e,t);if(p){l["backgroundPosition"]=p}return l};var kn=function(n,a,e,r,t,o){var i=En(r,t,o);var c=xn(n,a,e);if(c){i["objectPosition"]=c}if(a){i["objectFit"]=a}return i};var Dn=1e3;var Mn=function(n,a){var r=a.anchor,t=a.focus,o=a.mode,i=a.placeholder,c=a.preTransform,f=a.src,v=a.ratio,u=a.transitions;if(!i||!f||u.hasOwnProperty("zoom")||!z.domain){return""}var s=getComputedStyle(n);var d=o||X(s.backgroundSize)||"cover";var l;if(v===0){l=d==="contain"?1:e(s.height)/Math.max(1,e(s.width))}else{l=v!==null&&v!==void 0?v:e(s.fontSize)}var p=Dn;var m=Dn;if(l<1){p*=l}else{m/=l}p=Math.max(1,Math.round(p));m=Math.max(1,Math.round(m));return yn({domain:z.domain,path:z.path,src:f,transform:"".concat(Sn(r,t,o,c)).concat(d,"=").concat(m,"x").concat(p),output:i})};var zn=function(n,a){var e=["twic-w"];if(!a.hasOwnProperty("none")){if(a.hasOwnProperty("fade")){e.push("twic-tf")}if(a.hasOwnProperty("zoom")){e.push("twic-tz")}}if(z.env==="offline"){e.push("twic-offline");if(!n){e.push("twic-nosrc")}}return e.join(" ")};var $n=function(n){return n===0?{height:"100%",paddingTop:"0"}:{paddingTop:n===undefined?"":"".concat(n*100,"%")}};var jn=100;var An=new WeakMap;var Hn=c&&typeof MutationObserver!=="undefined"&&new MutationObserver((function(n){for(var a=0,e=n;a<e.length;a++){var r=e[a].target;var t=An.get(r);if(t){t.handleState()}}}));var Rn=c&&typeof ResizeObserver!=="undefined"&&new ResizeObserver((function(n){for(var a=0,e=n;a<e.length;a++){var r=e[a].target;var t=An.get(r);if(t){t.refreshBackground()}}}));var Ln=new RegExp("(?:\\s*)(?:".concat(z["class"],"-)(done|error|loading)"));var Bn=function(){function n(n){if(n===void 0){n=undefined}var a=this;this.handleState=function(){if(a.stateHandler){var n="new";var e=a.media.className;var r=Ln.exec(e);if(r){n=r[1]}a.stateHandler(n)}};this.refreshBackground=o((function(){if(a.placeholderData){var n=Mn(a.placeHolderElement,a.placeholderData);if(n&&n!==a.savedWrapperBackground){a.savedWrapperBackground=n;a.placeHolderElement.style.backgroundImage="url(".concat(JSON.stringify(n),")")}}}),{ms:jn});this.setMedia=function(n){if(n){z.handleShadowDom(n);a.media=n;An.set(a.media,a);a.placeHolderElement=n.nextElementSibling;if(Hn){Hn.observe(a.media,{attributes:true,attributeFilter:["class"]});a.handleState()}if(Rn){Rn.observe(a.media)}}};this.setPlaceholderData=function(n){a.placeholderData=n;if(a.media){a.refreshBackground()}};this.destroy=function(){if(a.media){if(a.media&&Rn){Rn.unobserve(a.media)}}};this.stateHandler=n}return n}();var Wn=function(n){return Object.entries(n).flatMap((function(n){var a=n[0],e=n[1];return e?["".concat(a.replace(/([a-z]|(?=[A-Z]))([A-Z])/g,"$1-$2").toLowerCase(),":").concat(e,";")]:[]})).join("")};export{Bn as Observer,On as computeAlt,Nn as computeData,Pn as computePlaceholderStyle,kn as computeStyle,zn as computeWrapperClass,$n as computeWrapperStyle,j as getDataAttributeName,B as installTwicPics,c as isBrowser,i as isWebComponents,V as parseAlt,K as parseAnchor,Z as parseBot,J as parseClassName,U as parseEager,Y as parseFocus,G as parseIntrinsic,X as parseMode,_ as parsePlaceholder,nn as parsePosition,an as parsePreTransform,en as parseRatio,on as parseSrc,rn as parseStep,fn as parseTransition,vn as parseTransitionDelay,un as parseTransitionDuration,sn as parseTransitionTimingFunction,Wn as styleToString};
//# sourceMappingURL=_utils.js.map
