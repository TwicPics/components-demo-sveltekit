import{openBlock as e,createElementBlock as t,createElementVNode as n,normalizeClass as o,normalizeStyle as i,createBlock as r,resolveDynamicComponent as s,mergeProps as a,normalizeProps as c,guardReactiveProps as l,renderSlot as d}from"vue";const m=e=>{if(!e)return;const{attributes:t,element:n,elementName:o,value:i}=e,r=n||document.createElement(o||"div");if(t&&r instanceof HTMLElement)for(const[e,n]of Object.entries(t))r.setAttribute(e,String(n));if(i)if("string"==typeof i)r.innerHTML=i;else for(const e of Array.isArray(i)?i:[i]){const t=m(e);t&&r.appendChild(t)}return r},u=/px$/,p=e=>Number(e.replace(u,"")),f=e=>`twicpics-components ${e}`,h="undefined"!=typeof document,$=e=>{console.warn(f(e))},w=()=>{},g=(e,t)=>n=>{let o;return n&&`${n}`.replace(e,((e,t)=>o=t)),t?t(o):o},v=e=>{throw new Error(f(e))},b=(e,t="\\s")=>new RegExp(`^(?:${t})*(${Array.isArray(e)?e.join("|"):e})(?:${t})*$`),y=["center"];for(const e of["","bottom","top"])for(const t of["","left","right"])(t||e)&&y.push(e?t?`${e}-${t}`:e:t);const T=b(y),S=b("\\s*(\\d+)\\s*[x]\\s*(\\d+)\\s*"),x=b(["contain","cover"]),_=b(["maincolor","meancolor","none","preview"]),D=b("(\\d+(?:\\.\\d+)?)(?:\\s*[\\/:]\\s*(\\d+(?:\\.\\d+)?))?|(none)"),N=b(["debug","offline","production"]),V={debug:!1,class:"twic",domain:void 0,env:"production",handleShadowDom:w,maxDPR:void 0,path:"",step:void 0},O=()=>`.twic-w>.${V.class}-done+div,.twic-w>.${V.class}-poster-done+div{opacity:0 !important}.twic-w>.${V.class}-done,.twic-w>.${V.class}-poster-done{transform:none !important}`,E=e=>`data-${V.class}-${e}`,k=/\?|^\/*$/,M=/(^https?:\/\/[^/]+)\/*$/,P=[["anticipation","anticipation"],["class","class"],["maxDPR","max-dpr"],["step","step"]];var j=(e,t)=>{const{component:n,componentName:o,tag:i}=t,{computed:r}=n;e.component(o,Object.assign(Object.assign({},n),{name:o,computed:Object.assign(Object.assign({},r),i?{_is:()=>i}:{})}))};const z=(e,t,n)=>({type:e,default:n,validator:t&&(e=>t.test(String(e)))}),A=e=>z(String,e),H=(e,t)=>z([Boolean,String],e,t),I=z([Number,String],/^\d+$/),R=A(),C=/^(image:)?\/*/,B=e=>!isNaN(e)&&e>0,F=g(b(".+?")),W=b(".+?","[\\s\\/]"),L=/\b(?:(left|right)|(bottom|top))\b/g,q=e=>{const t=F(e);let n,o;if(t){let e;for(;e=L.exec(t);)e[1]?n=e[1]:o=e[2]}return{x:n,y:o}},J=F,Y=e=>"string"==typeof e?e.trim():void 0,G=F,K=e=>{if(!e)return;let t;const n=S.exec(e);if(n){const[,,e,o]=n;t=`${e}x${o}`}return t},Q={true:!0,false:!1,"":!0},U=e=>"boolean"==typeof e?e:void 0!==e&&(Q[e.trim()]||!1),X=g(x),Z=(e,t)=>{if("offline"!==V.env&&F(t)&&"none"!==e)return _.test(e)?e:"preview"},ee=F,te=g(W,(e=>e&&`${e}/`)),ne=e=>{if("none"===e)return 0;let t;if("number"==typeof e)t=e;else if(e){const n=D.exec(e);if(n){const[,,e,o]=n;t=(o?Number(o):1)/Number(e)}else t=1}return B(t)?t:void 0},oe=e=>{if("number"!=typeof e){const t=F(e);e=t&&Number(t)}return B(e)?e:void 0},ie=e=>((e=F(e))||$("src is not provided"),"offline"===V.env?"":(e=>e?e.replace(C,`image:${V.path}`):"placeholder:red")(e)),re={true:"fade",false:"none",fade:"fade",zoom:"zoom",none:"none"},se=e=>{"boolean"!=typeof e&&(e=F(e)||!0);const t={};return String(e).split(/\s*\+\s*|\s+/).forEach((e=>t[`${re[e]||"fade"}`]=!0)),t},ae=F,ce=F,le=F,de=/^(?:(auth|placeholder|rel)|(image|media|video)|[^:]*):(\/*)((v[0-9]+(?=[/?]))?[^?]*(\?.*)?)$/,me=({x:e,y:t},n,o)=>"contain"===n&&(o||(t?e?`${e} ${t}`:t:e)),ue=({x:e,y:t},n,o,i,r=!1)=>{const s="contain"!==o&&(n||(t?e?`${t}-${e}`:t:e));return`${r?"debug/":""}${i||""}${s?`focus=${s}/`:""}`},pe=(e,t,n)=>{const o={};return t&&(o.transitionDuration=t),e&&(o.transitionDelay=e),n&&(o.transitionTimingFunction=n),o},fe=/\/?([^/?#.]+)(?:\.[^/?#]*)?(?:[?#].*)?$/,he=(e,t)=>{if(!e){const n=fe.exec(t);e=n&&n[1]||"image"}return e},$e=(e,t,n,o,i,r,s,a,c,l)=>{const d={},m=ue(e,o,s,a,"debug"===V.env);return"string"==typeof t&&(d[E("bot")]=t||"/"),n&&(d[E("eager")]=""),i&&(d[E("intrinsic")]=i),r&&(d[E("poster")]=c,d[E("poster-transform")]=`${m}*/output=image`),c&&(d[E("src")]=c),void 0!==l&&(d[E("step")]=String(l)),m&&(d[E("transform")]=`${m}*`),d},we=(e,t,n,o,i,r,s,a,c,l,d,m,u)=>{const p=pe(l,d,m);u({anchor:e,focus:t,mode:n,placeholder:o,preTransform:r,ratio:s,src:a,transitions:c}),n&&(p.backgroundSize=n);const f=me(e,n,i);return f&&(p.backgroundPosition=f),p},ge=(e,t,n,o,i,r)=>{const s=pe(o,i,r),a=me(e,t,n);return a&&(s.objectPosition=a),t&&(s.objectFit=t),s},ve=(e,t)=>{const n=["twic-w"];return t.hasOwnProperty("none")||(t.hasOwnProperty("fade")&&n.push("twic-tf"),t.hasOwnProperty("zoom")&&n.push("twic-tz")),"offline"===V.env&&(n.push("twic-offline"),e||n.push("twic-nosrc")),n.join(" ")},be=e=>0===e?{height:"100%",paddingTop:"0"}:{paddingTop:void 0===e?"":100*e+"%"},ye=new WeakMap,Te=h&&"undefined"!=typeof MutationObserver&&new MutationObserver((e=>{for(const{target:t}of e){const e=ye.get(t);e&&e.handleState()}})),Se=h&&"undefined"!=typeof ResizeObserver&&new ResizeObserver((e=>{for(const{target:t}of e){const e=ye.get(t);e&&e.refreshBackground()}})),xe=new RegExp(`(?:\\s*)(?:${V.class}-)(done|error|loading)`);class _e{constructor(e){this.handleState=()=>{if(this.stateHandler){let e="new";const{className:t}=this.media,n=xe.exec(t);n&&([,e]=n),this.stateHandler(e)}},this.refreshBackground=((e,t)=>{let n;const o=Object.assign({leading:!0,ms:0,trailing:!0},{ms:100});return(...t)=>{!n&&o.leading&&e(...t),clearTimeout(n),n=setTimeout((()=>{n=void 0,o.trailing&&e(...t)}),o.ms)}})((()=>{if(this.placeholderData){const e=((e,{anchor:t,focus:n,mode:o,placeholder:i,preTransform:r,src:s,ratio:a,transitions:c})=>{if(!i||!s||c.hasOwnProperty("zoom")||!V.domain)return"";const l=getComputedStyle(e),d=o||X(l.backgroundSize)||"cover";let m;m=0===a?"contain"===d?1:p(l.height)/Math.max(1,p(l.width)):null!=a?a:p(l.fontSize);let u=1e3,f=1e3;return m<1?u*=m:f/=m,u=Math.max(1,Math.round(u)),f=Math.max(1,Math.round(f)),(({debug:e,domain:t,path:n,output:o,quality:i,src:r,transform:s})=>{const a=`${t}/`,c=r.slice(0,a.length)===a,l=c?`media:${r.slice(a.length)}`:r,d=de.exec(l),m=d&&d[2],u=e?"/debug":"",p=o?`/output=${o}`:"",f=m?n&&!c?`${n}${d[3]?d[3][0]:""}${d[4]}`:d[4]:l,h=i?`/quality=${i}`:"",$=s?`/${s}`:"";return`${a}${d&&(d[1]||d[5])?`v1${u}${$}${p}/${m?`${d[2]}:${f}`:f}${h}`:`${f}${d&&d[6]?"&":"?"}twic=v1${u}${$}${p}${h}`}`})({domain:V.domain,path:V.path,src:s,transform:`${ue(t,n,o,r)}${d}=${f}x${u}`,output:i})})(this.placeHolderElement,this.placeholderData);e&&e!==this.savedWrapperBackground&&(this.savedWrapperBackground=e,this.placeHolderElement.style.backgroundImage=`url(${JSON.stringify(e)})`)}})),this.setMedia=e=>{e&&(V.handleShadowDom(e),this.media=e,ye.set(this.media,this),this.placeHolderElement=e.nextElementSibling,Te&&(Te.observe(this.media,{attributes:!0,attributeFilter:["class"]}),this.handleState()),Se&&Se.observe(this.media))},this.setPlaceholderData=e=>{this.placeholderData=e,this.media&&this.refreshBackground()},this.destroy=()=>{this.media&&this.media&&Se&&Se.unobserve(this.media)},this.stateHandler=e}}const De=/^(\*+)(.*[^*])(\*+)$/,Ne=(e,t,n=!1)=>{const o=t.map((e=>"function"==typeof e?{f:e}:{s:n?`${e}`:De.test(`${e}`)?`${`${e}`.replace(De,"$2")}`:`p_${e}`}));return function(){return e(...o.map((({f:e,s:t})=>e?e(this):this[t])))}},Ve={p_isVideo(){return"video"===this._is}},Oe={};for(const[e,t,n,o]of[["alt",R,J],["anchor",A(T),q],["bot",R,Y],["focus",R,G],["intrinsic",A(S),K],["mode",A(x),X],["eager",H(null,!1),U],["placeholder",A(_),Z,["placeholder","src"]],["position",R,ee],["preTransform",R,te],["ratio",A(D),ne],["src",R,ie],["step",I,oe],["transition",H(null,!0),se],["transitionDelay",R,ae],["transitionDuration",R,ce],["transitionTimingFunction",R,le]])Ve[`p_${e}`]=Ne(n,o||[e],!0),Oe[e]=t;for(const[e,t,n]of[["_alt",he,["alt","src"]],["_dataAttributes",$e,["anchor","bot","eager","focus","intrinsic","isVideo","mode","preTransform","src","step"]],["_style",ge,["anchor","mode","position","transitionDelay","transitionDuration","transitionTimingFunction"]],["_placeholderStyle",we,["anchor","focus","mode","placeholder","position","preTransform","ratio","src","transition","transitionDelay","transitionDuration","transitionTimingFunction",e=>e.observer.setPlaceholderData]],["_wrapperClass",ve,["src","transition"]],["_wrapperStyle",be,["ratio"]]])Ve[e]=Ne(t,n);var Ee={props:Oe,emits:["stateChange"],computed:Ve,beforeCreate(){this.observer=new _e((e=>{this.$emit("stateChange",{target:this,state:e})}))},mounted(){this.observer.setMedia(this.$refs.media)},unmounted(){this.observer.destroy()}};const ke={class:"twic-i"};Ee.render=function(c,l,d,m,u,p){return e(),t("div",ke,[n("div",{class:o(c._wrapperClass),style:i(c._wrapperStyle)},[(e(),r(s(c._is),a({ref:"media",alt:c._alt,style:c._style},{...c._dataAttributes}),null,16,["alt","style"])),n("div",{style:i(c._placeholderStyle)},null,4)],6)])},Ee.__file="src/vue/img-video.vue";const Me={[E("view")]:""};var Pe={computed:{viewAttributes:()=>Me},render:function(n,o,i,r,s,a){return e(),t("div",c(l(n.viewAttributes)),[d(n.$slots,"default")],16)},__file:"src/vue/View.vue"};const je=(e,t)=>{(e=>{e||v("install options not provided");const t=V&&V.domain,{domain:n,class:o,env:i,handleShadowDom:r,path:s}=e;if(n&&M.test(n)||v(`install domain "${n}" is invalid`),s&&k.test(s)&&v(`install path "${s}" is invalid`),i&&!N.test(i)&&v(`install env "${i}" is invalid`),V.class=o||"twic",V.domain=n.replace(M,"$1"),V.env=i,V.path=s?s.replace(/^\/*(.+?)\/*$/,"$1/"):"",V.handleShadowDom=r&&h?(e=>{const t=new WeakSet;return n=>{for(;n&&!t.has(n);){t.add(n);const{parentNode:o}=n;if(!o&&n instanceof ShadowRoot){if("closed"===n.mode)throw new Error("cannot use TwicPics components in closed ShadowRoot");m({element:n,value:{elementName:"style",value:`.twic-i{overflow:hidden}.twic-w,.twic-w *{border:none;margin:0;overflow:hidden;padding:0}.twic-w{overflow:hidden;position:relative;padding-top:100%;width:100%;padding-top:calc(100% / var(--twic-ratio,1))}.twic-w>*{display:block;left:0;height:100%;position:absolute;top:0;width:100%;transition-property:opacity,transform;will-change:opacity,transform;object-fit:cover;object-position:center;transition-delay:0s;transition-duration:.4s;transition-timing-function:ease;object-fit:var(--twic-mode,cover);object-position:var(--twic-position,center);transition-delay:var(--twic-transition-delay,0s);transition-duration:var(--twic-transition-duration,400ms);transition-timing-function:var(--twic-transition-timing-function,ease)}.twic-w>div{background-repeat:no-repeat;background-size:cover;background-position:center;background-size:var(--twic-mode,cover);background-position:var(--twic-position,center);font-size:calc(1px / var(--twic-ratio,1))}.twic-w>img:not([src]),.twic-w>img[src=\"\"]{visibility:hidden}.twic-w.twic-tz>img{transform:scale(0)}.twic-w.twic-tf>div{opacity:1}.twic-d{display:block;width:100%}.twic-offline{background-color:#ccc}.twic-offline.twic-nosrc{background-color:#fd0016}.twic-offline>*{display:none}${O()}`}}),(n=n.host)&&n.setAttribute(e,"")}else n=o}}})(E("component")):w,h){if(t)return void $("install function called multiple times");const o=[`${V.domain}/?v1`];P.forEach((t=>{const[n,i]=t;e.hasOwnProperty(n)&&e[n]&&o.push(`${i}=${e[n]}`)})),m({element:document.head,value:[{attributes:{rel:"preconnect",href:n},elementName:"link"},{attributes:{async:"",defer:"",src:o.join("&")},elementName:"script"},{value:O(),elementName:"style"}]})}})(t),t.TwicImg&&t.TwicImg===t.TwicVideo&&v("TwicImg and TwicVideo components must have different names"),t.TwicView&&t.TwicView===t.TwicImg&&v("TwicView and TwicImg components must have different names"),t.TwicView&&t.TwicView===t.TwicVideo&&v("TwicView and TwicVideo components must have different names"),j(e,{component:Ee,componentName:t.TwicImg||"TwicImg",tag:"img"}),j(e,{component:Ee,componentName:t.TwicVideo||"TwicVideo",tag:"video"}),j(e,{component:Pe,componentName:t.TwicView||"TwicView"})};export{je as default};
//# sourceMappingURL=module.mjs.map
